This isn't my best work, but its something. 
Code is messy and prob overcomplex.
Many things will be redone, don't consider it stable.
